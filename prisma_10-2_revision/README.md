# PRISMA Initialization

## Steps

- Create fresh project -

  `npm init -y`

- Intall dependencies -

  `npm i prisma typescript ts-node @types/node --save-dev`

- create `tsconfog.json`

  `npx tsc --init`

  make changes -

  `rootDir to 'src'`
  `outDir to dist`

- Initialize schema.prisma

  `npx prisma init`

- Selecting the DataBase - go to `schema.prisma` and update - `DATABASE_URL`

  - or add under `.env` file variable -
    `DATABASE_URL="postgresql://postgres.xxxtiilrgrknxxzzkhxg:[YOUR-PASSWORD]@aws-0-ap-south-1.pooler.supabase.com:5432/postgres"`

- Create a new schemas for User and Todo under - `schema.prisma`

  ```
  model User {
  id        Int    @id @default(autoincrement())
  username  String @unique
  password  String
  firstName String
  lastName  String
  }

  model Todo {
  id Int @id @default(autoincrement())
  title String
  description String
  done Boolean @default(false)
  userId Int
  }

  ```

- Migration - (By migration CREATE TABLE quesry will be done) -

  `npx prisma migrate dev --name InitUserAndTodoAdded`

  (`InitUserAndTodoAdded` - is the name of the migration)

- After running the migration you should see the migrations folder included migration file -

  - and logs -
    ![Migration_initilization_successful_logs](IMAGES_LEARN/MIGRATION_INIT.png)
  - if it showing - `Your database is now in sync with your schema.` means everything is fine and you can see under your database tables created
  - We can open migration files and can check what those files contain (same queries will be there which used to create the tables)

- GENERATE PRISMA CLIENT (`Autogenerated Client`)

  - We need to do tasks using Tables - `User and Todo`, but till now we do not have access to `User and Todo` which we can use under our nodejs
  - so for use that tables we need javascript classes/clients for - `User and Todo`, so we can do `User.create`, `Todo.create` etc.

  - CMD for `Autogenerated Client` - `npm prisma generate`

  Will show log -
  ![Autogenerated Prisma Client](IMAGES_LEARN/AUTOGENERATED_PRISMA_CLIENT.png)

- Now create `src/index.ts`

- Now we need to import the client -

  ```
  import { PrismaClient } from '@prisma/client'

  const prisma = new PrismaClient()
  // use `prisma` in your application to read and write data in your DB
  ```

  it is same as we do on mongoose client -

  ```
  import mongoose from 'mongoose`

  mongoose.connect();
  ```

- Now we have access to `User and Todo` tables -

  - and we can do `prisma.user.create({...})`, `prisma.todo.find({...})` and many more queries on tables
  - Creating a new user -

  ```
  async function insertUser(
    username: string,
    password: string,
    firstName: string,
    lastName: string
  ) {
    const res = await prisma.user.create({
      data: {
        username,
        firstName,
        lastName,
        password,
      },
      select: {
        id: true,
        username: true,
        firstName: true,
        lastName: true,
      },
    });

    console.log("USER", res);
  }
  // calling ------
  insertUser("test1@gmail.com", "123456", "Ajay1", "Dew1");
  ```

- Queries - Now we can refer `Prisma Docs` and make queires, like -

  - CREATE -

    ```
    await prisma.user.create({})
    ```

  - UPDATE -

    ```
    await prisma.user.update({})
    ```

  - SELECT -
    ```
    await prisma.user.findFirst({})
    ```

- RELATIONSHIPS -

  - For that we need to update prisma schema -
  - Under user model, add -

    ```
    todos     Todo[]
    ```

  - and under todo model, add -

    ```
    User        User    @relation(fields: [userId], references: [id])
    ```

  - Update the `database` and `prisma client` -

    - `npx prisma migrate dev --name relationship`
    - `npx prisma generate`

    - will show log -
      ![Relationship created](IMAGES_LEARN/RELATIONSHIPS_CREATED.png)
      ![Migration after relationship](IMAGES_LEARN/MIGRATION_AFTER_REALTIONS.png)

- Create TODO -

  - 
